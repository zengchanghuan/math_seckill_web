/**
 * 测评题集配置
 * V1: 固定10题测评集
 */

export interface AssessmentSetMeta {
  itemId: string;
  knowledge: string; // 主知识点
  difficulty: 1 | 2 | 3; // 1=基础 2=中等 3=困难
  expectedTimeSec: number; // 预期用时（秒）
}

export interface AssessmentSet {
  setId: string;
  name: string;
  version: number;
  totalQuestions: number;
  suggestedTimeSec: number;
  itemIds: string[];
  meta: Record<string, AssessmentSetMeta>; // itemId -> meta
}

// V1 固定测评题集（10题）
export const ASSESSMENT_SET_V1: AssessmentSet = {
  setId: 'assessment_set_v1',
  name: '高等数学水平测评 V1',
  version: 1,
  totalQuestions: 10,
  suggestedTimeSec: 300, // 5分钟

  // 固定题目ID（从已有题库中选择）
  itemIds: [
    '2023-1-1',  // 基础极限
    '2023-1-2',  // 导数定义
    '2023-2-1',  // 基本导数
    '2023-2-2',  // 链式法则
    '2023-2-3',  // 不定积分
    '2023-3-1',  // 换元积分
    '2023-3-2',  // 定积分计算
    '2023-4-1',  // 微分方程
    '2023-5-1',  // 极值与最值
    '2023-6-1',  // 二重积分
  ],

  // 题目元数据
  meta: {
    '2023-1-1': {
      itemId: '2023-1-1',
      knowledge: '极限-基本极限',
      difficulty: 1,
      expectedTimeSec: 45,
    },
    '2023-1-2': {
      itemId: '2023-1-2',
      knowledge: '导数-导数定义',
      difficulty: 2,
      expectedTimeSec: 60,
    },
    '2023-2-1': {
      itemId: '2023-2-1',
      knowledge: '导数-基本导数公式',
      difficulty: 1,
      expectedTimeSec: 30,
    },
    '2023-2-2': {
      itemId: '2023-2-2',
      knowledge: '导数-链式法则',
      difficulty: 2,
      expectedTimeSec: 60,
    },
    '2023-2-3': {
      itemId: '2023-2-3',
      knowledge: '积分-不定积分',
      difficulty: 2,
      expectedTimeSec: 45,
    },
    '2023-3-1': {
      itemId: '2023-3-1',
      knowledge: '积分-换元法',
      difficulty: 2,
      expectedTimeSec: 60,
    },
    '2023-3-2': {
      itemId: '2023-3-2',
      knowledge: '积分-定积分',
      difficulty: 2,
      expectedTimeSec: 60,
    },
    '2023-4-1': {
      itemId: '2023-4-1',
      knowledge: '微分方程-一阶',
      difficulty: 3,
      expectedTimeSec: 90,
    },
    '2023-5-1': {
      itemId: '2023-5-1',
      knowledge: '应用-极值',
      difficulty: 2,
      expectedTimeSec: 60,
    },
    '2023-6-1': {
      itemId: '2023-6-1',
      knowledge: '多元-二重积分',
      difficulty: 3,
      expectedTimeSec: 90,
    },
  },
};

// 知识点先修映射（用于生成建议）
export const PREREQ_MAP: Record<string, string> = {
  '极限-基本极限': '三角恒等变形',
  '导数-链式法则': '复合函数与代数变形',
  '积分-换元法': '微分形式与代换',
  '积分-分部积分': '常见结构识别',
  '微分方程-一阶': '积分与分离变量',
  '应用-极值': '导数的应用',
  '多元-二重积分': '定积分与累次积分',
};

// Day1 题包映射（V1: 硬编码，每个知识点对应12道题ID）
export const DAY1_ITEM_MAP: Record<string, string[]> = {
  '极限-基本极限': [
    '2021-1-1', '2021-1-2', '2021-1-3', '2021-1-4',
    '2022-1-1', '2022-1-2', '2022-1-3', '2022-1-4',
    '2023-1-1', '2023-1-2', '2023-1-3', '2023-1-4',
  ],
  '导数-导数定义': [
    '2021-1-5', '2021-1-6', '2021-1-7', '2021-1-8',
    '2022-1-5', '2022-1-6', '2022-1-7', '2022-1-8',
    '2023-1-5', '2023-1-6', '2023-1-7', '2023-1-8',
  ],
  '导数-基本导数公式': [
    '2021-2-1', '2021-2-2', '2021-2-3', '2021-2-4',
    '2022-2-1', '2022-2-2', '2022-2-3', '2022-2-4',
    '2023-2-1', '2023-2-2', '2023-2-3', '2023-2-4',
  ],
  '导数-链式法则': [
    '2021-2-5', '2021-2-6', '2021-2-7', '2021-2-8',
    '2022-2-5', '2022-2-6', '2022-2-7', '2022-2-8',
    '2023-2-5', '2023-2-6', '2023-2-7', '2023-2-8',
  ],
  '积分-不定积分': [
    '2021-3-1', '2021-3-2', '2021-3-3', '2021-3-4',
    '2022-3-1', '2022-3-2', '2022-3-3', '2022-3-4',
    '2023-3-1', '2023-3-2', '2023-3-3', '2023-3-4',
  ],
  '积分-换元法': [
    '2021-3-5', '2021-3-6', '2021-3-7', '2021-3-8',
    '2022-3-5', '2022-3-6', '2022-3-7', '2022-3-8',
    '2023-3-5', '2023-3-6', '2023-3-7', '2023-3-8',
  ],
  '积分-定积分': [
    '2021-3-9', '2021-3-10', '2021-3-11', '2021-3-12',
    '2022-3-9', '2022-3-10', '2022-3-11', '2022-3-12',
    '2023-3-9', '2023-3-10', '2023-3-11', '2023-3-12',
  ],
  '微分方程-一阶': [
    '2021-4-1', '2021-4-2', '2021-4-3', '2021-4-4',
    '2022-4-1', '2022-4-2', '2022-4-3', '2022-4-4',
    '2023-4-1', '2023-4-2', '2023-4-3', '2023-4-4',
  ],
  '应用-极值': [
    '2021-5-1', '2021-5-2', '2021-5-3', '2021-5-4',
    '2022-5-1', '2022-5-2', '2022-5-3', '2022-5-4',
    '2023-5-1', '2023-5-2', '2023-5-3', '2023-5-4',
  ],
  '多元-二重积分': [
    '2021-6-1', '2021-6-2', '2021-6-3', '2021-6-4',
    '2022-6-1', '2022-6-2', '2022-6-3', '2022-6-4',
    '2023-6-1', '2023-6-2', '2023-6-3', '2023-6-4',
  ],
  // 默认兜底
  'default': [
    '2021-1-1', '2021-1-2', '2021-2-1', '2021-2-2',
    '2022-1-1', '2022-1-2', '2022-2-1', '2022-2-2',
    '2023-1-1', '2023-1-2', '2023-2-1', '2023-2-2',
  ],
};

/**
 * 获取测评题集
 */
export function getAssessmentSet(setId: string = 'assessment_set_v1'): AssessmentSet {
  if (setId === 'assessment_set_v1') {
    return ASSESSMENT_SET_V1;
  }
  return ASSESSMENT_SET_V1; // 默认返回V1
}

/**
 * 获取Day1题包
 */
export function getDay1Items(knowledge: string): string[] {
  return DAY1_ITEM_MAP[knowledge] || DAY1_ITEM_MAP['default'];
}

/**
 * 获取先修知识点
 */
export function getPrerequisite(knowledge: string): string | undefined {
  return PREREQ_MAP[knowledge];
}



